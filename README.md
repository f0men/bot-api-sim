# User Activity Tracker

## Описание проекта

User Activity Tracker – это инструмент, разработанный для автоматизации сбора активности пользователей в LMS (Learning Management System). Каждый день в полночь скрипт выполняет задание по извлечению статистики активности пользователей через API, после чего данная информация обрабатывается и сохраняется в нескольких местах:

- Логи записываются в папку `logs` для последующего анализа и отладки.
- Данные загружаются в Google Sheets для удобного просмотра и анализа.
- Рассылки отправляются на указанные email-адреса с ежедневными отчетами.
- Информация также сохраняется в базе данных PostgreSQL для долгосрочного хранения и быстрого доступа.

Кроме того, для удобства пользователей создан бот, который позволяет запрашивать текстовый файл с ежедневным отчетом по активности, отображать графики в чате, а также предоставляет ссылку на Google Sheets.
**Ссылка на бота:** [Tg-bot](https://t.me/DailyReportChartsBot) для проверки работоспособности


## Стек технологий

- **Язык программирования:** Python
- **Библиотеки:**
  - `requests` – для работы с API
  - `psycopg2` – для взаимодействия с PostgreSQL
  - `gspread` – для работы с Google Sheets
  - `smtplib` – для отправки email
  - `matplotlib` – для построения графиков
  - `python-telegram-bot` – для создания Telegram-бота
- **База данных:** PostgreSQL
- **Операционная система:** Ubuntu

## Установка

1. Клонируйте репозиторий:
   `git clone https://github.com/username/repo.git`

2. Установите зависимости:
    `pip install -r requirements.txt`

3. Настройте конфигурацию:
    Отредактируйте файл `config.py`, чтобы добавить ваши API-ключи, учетные данные для базы данных и настройки email.

4. Создайте таблицы в PostgreSQL:
```
CREATE TABLE database_api_simulative.user_activity (
	id serial4 NOT NULL,
	user_id text NULL,
	oauth_consumer_key text NULL,
	lis_result_sourcedid text NULL,
	lis_outcome_service_url text NULL,
	is_correct bool NULL,
	attempt_type varchar(10) NULL,
	created_at timestamp NULL
);
```
## Автоматизация

Скрипты настроены на автоматический запуск через планировщик `cron` и `pm2`- для бота

## Использование бота

Бот предоставит команды, такие как:
- `/Получить данные в формате txt` – отправляет текстовый файл с отчетом о ежедневной активности.
- `/Отобразить графики в чате` – отображает график активности пользователей.
- `/Перейти в Google sheets` – отправляет ссылку на Google Sheets.
- `/Перезапуск` – Перезапуск бота.
